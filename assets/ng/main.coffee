(window.btoa = (str) -> Base64.encode(str)) if (!window.btoa)
(window.atob = (str) -> Base64.decode(str)) if (!window.atob)

drum = angular.module('drum', ["mgcrea.ngStrap"])

drum.filter('range', ->
  (val, range) ->
    range = parseInt(range) - 1
    [0..range]
)

drum.filter('trackJson', ->
  (object) ->
    return '' unless object
    JSON.stringify(object)
)

instruments =
  kick: [0, 420]
  snare: [453, 434]
  clap: [11383, 157]
  cowbell: [908, 115]
  hiTom: [1360, 602]
  midTom: [1997, 851]
  lowTom: [2894, 839]
  hatOpen: [3756, 955]
  hatClosed: [4734, 130]
  ride: [4911, 962]
  tamb: [5878, 277]
  crash: [6830, 1267]
  splash: [8127, 843]
  china: [9578, 855]
  hiAgogo: [10591, 433]
  lowAgogo: [11095, 273]

instrumentNames = Object.keys(instruments)

vols =
  1: 1
  2: 0.6
  3: 0.4

songs =
  "Californication - RHCP": {"tempo":190,"beatCount":8,"channels":{"snare":[0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1],"kick":[1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],"ride":[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1],"crash":[1],"splash":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0]}}
  "Naive - The Kooks": {"tempo":100,"beatCount":4,"channels":{"kick":[1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1],"snare":[0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0],"hatOpen":[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],"hatClosed":[1,0,0,0,1,0,1,0,1,0,1,0,1,0,1],"splash":[1]}}
  "Rockin' the Suburbs - Ben Folds": {"tempo":180,"beatCount":12,"channels":{"kick":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],"snare":[1,1,1,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],"midTom":[0,0,0,0,0,0,0,0,0,0,1,0,1],"lowTom":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],"hiTom":[0,0,0,0,0,0,1,0,1],"ride":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],"crash":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]}}
  "King Of Rock - Run DMC": {"tempo":100,"beatCount":4,"channels":{"kick":[1,0,0,0,0,0,0,0,1,0,1,0,0,0,1,1],"snare":[0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,0],"cowbell":[1,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0],"ride":[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],"crash":[1]}}
  "Fix You - Coldplay": {"tempo":140,"beatCount":8,"channels":{"kick":[1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],"snare":[0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1],"crash":[1 ],"ride":[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0],"splash":[0,0,0,0,1],"midTom":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],"lowTom":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],"china":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]}}
  "Airbag - Radiohead": {"tempo":170,"beatCount":8,"channels":{"kick":[1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1],"snare":[0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],"tamb":[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],"hatClosed":[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0],"hatOpen":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1]}}
  "Paranoid Android (7/8 bit) - Radiohead": {"tempo":151,"beatCount":7,"channels":{"snare":[0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0],"kick":[1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1],"ride":[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1],"hatOpen":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],"crash":[1]}}
  "Every Teardrop Is a Waterfall - Coldplay": {"tempo":120,"beatCount":8,"channels":{"snare":[0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,0,1,1,1,1,1,1],"kick":[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1],"hatClosed":[0,0,0,0,1,1,0,0,1,0,1,1,0,1,1,1,0,0,0,0,0,1,0,1,0,0,1,1,1,0,0,0],"hatOpen":[0,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,0,0,0,1,0],"crash":[1,null,null,0]}}
  "R U Mine? - Arctic Monekys": {"tempo":180,"beatCount":8,"channels":{"kick":[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0],"snare":[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0],"hiTom":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0],"midTom":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],"lowTom":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],"hatOpen":[0,0,0,0,1],"ride":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],"crash":[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],"splash":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1],"china":[0,0,0,0,0,0,0,0,1]}}
  "Samba": {"tempo":105,"beatCount":4,"channels":{"snare":[1,1,1,1,0,1,0,1,1,0,1,0,1,0,0,1],"kick":[1,0,0,0,1,0,0,0,1,0,0,0,1],"clap":[0,0,1,1,0,1,0,1,0,1,0,1,0,0,1],"hiAgogo":[1,0,1,0,0,0,0,1,0,1,0,1],"lowAgogo":[0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0],"crash":[1],"splash":[0,0,0,0,0,0,0,1],"china":[0,0,0,1,0,0,0,0,0,0,0,0,1]}}

defaultTrack = {"tempo":120,"beatCount":4,"channels":{"snare":[1,0,0,2,0,0,3,0,0,2,0,0,1]}}
# defaultTrack = {"tempo":120,"beatCount":4,"channels":{"snare":[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],"kick":[1,0,0,0,0,0,0,1,0,1,1,0,0,0,1],"hatClosed":[1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0],"hatOpen":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0]}}